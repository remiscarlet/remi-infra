version: "3"  # optional since v1.27.0
services:
  shoko_server:
    container_name: shokoserver
    image: shokoanime/server:daily
    restart: always
    environment:
      - "PUID=${UID}"
      - "PGID=${GID}"
      - "TZ=Etc/UTC"
    ports:
      - "8111:8111"
    volumes:
      - "${HOME}/.shoko:/home/shoko/.shoko"
      - /media/daiyousei/anime:/mnt/anime
      - /media/daiyousei/anime_bd:/mnt/anime_bd
      - /media/daiyousei/anime_movies:/mnt/anime_movies
      - /media/daiyousei/shoko/import:/mnt/import
      - /media/daiyousei/rtorrent:/mnt/rtorrent

  flood:
    container_name: flood
    hostname: flood
    image: jesec/flood
    user: "${UID}:${GID}"
    restart: unless-stopped
    command: --port 3001
    depends_on:
      - rtorrent
    environment:
      HOME: /config
    volumes:
      - /home/cirno/dlconfig:/config
      - /media/daiyousei:/data
    ports:
      - 0.0.0.0:3001:3001

  rtorrent:
    container_name: rtorrent
    hostname: rtorrent
    image: jesec/rtorrent
    user: "${UID}:${GID}"
    restart: unless-stopped
    command: -o network.port_range.set=6881-6881,system.daemon.set=true
    environment:
      HOME: /config
    volumes:
      - /home/cirno/dlconfig:/config
      - /media/daiyousei:/data
    ports:
      - 0.0.0.0:6881:6881

  node_exporter:
    image: quay.io/prometheus/node-exporter:latest
    container_name: node_exporter
    command:
      - '--path.rootfs=/host'
    network_mode: host
    pid: host
    restart: unless-stopped
    volumes:
      - '/:/host:ro,rslave'
    ports:
      - 0.0.0.0:9100:9100

  telegraf:
    container_name: telegraf
    image: telegraf
    hostname: cirno
    ports:
      - 0.0.0.0:9273:9273
    volumes:
      - $PWD/../../configs/telegraf.conf:/etc/telegraf/telegraf.conf:ro
      - /var/run/docker.sock:/var/run/dopcker.sock
      - /:/hostfs:ro
    environment:
      HOST_ETC: /hostfs/etc
      HOST_PROC: /hostfs/proc
      HOST_SYS: /hostfs/sys
      HOST_VAR: /hostfs/var
      HOST_RUN: /hostfs/run
      HOST_MOUNT_PREFIX: /hostfs

